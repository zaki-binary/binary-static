module.exports = function (grunt) {
    const common = [
        // Top level (dist)
        ...(global.is_release ? [] : [
            { expand: true, cwd: 'scripts', src: ['CNAME'], dest: 'dist' },
        ]),
        { expand: true, cwd: 'src/root_files/_common',  src: ['**'], dest: 'dist' },
        { expand: true, cwd: 'src/images/common/logos', src: ['**'], dest: `${global.dist}/images/common/logos/` },

        // This branch
        { expand: true, cwd: 'src/download/fonts', src: ['binary_symbols.woff'], dest: `${global.dist}/download/fonts/` },

        { expand: true, cwd: `${global.node_modules_paths.binary_style}/src/images/favicons`, src: ['favicon.ico'], dest: global.dist },

        // Serve pushwoosh SDKs
        { expand: true, cwd: 'src/javascript/_common/lib/pushwooshSDK/', src: ['**'], dest: global.dist },
    ];

    const config = {
        app: {
            files: [
                ...common,
                { expand: true, cwd:  'src/root_files/app', src: ['**', '!index.html'], dest: 'dist' }, // top level
                { expand: true, cwd:  'src/root_files/app', src: ['index.html'],        dest: global.dist },

                // app, static
                { expand: true, cwd: 'src/download/',                  src: ['**'],                               dest: `${global.dist}/download/` },
                { expand: true, cwd: 'src/images/',                    src: ['**', '!app_2/**', '!common/logos'], dest: `${global.dist}/images/` },
                { expand: true, cwd: 'src/javascript/_autogenerated/', src: ['*.js'],                             dest: `${global.dist}/js/texts/` },
                { expand: true, cwd: 'src/javascript/',                src: ['manifest.json'],                    dest: global.dist },

                // binary-style
                { expand: true, cwd: `${global.node_modules_paths.binary_style}/src/images/favicons`, src: ['**'], dest: `${global.dist}/images/favicons/` },
                { expand: true, cwd: `${global.node_modules_paths.binary_style}/src/images/logo`,     src: ['**'], dest: `${global.dist}/images/logo/` },
            ],
        },
        app_2: {
            files: [
                ...common,
                { expand: true, cwd:  'src/root_files/app_2', src: ['sitemap*.xml'],      dest: 'dist' }, // top level
                { expand: true, cwd:  'src/root_files/app_2', src: ['index.html'],        dest: global.dist_app_2 },

                // app_2
                { expand: true, cwd: 'src/images/app_2',                     src: ['**'],   dest: `${global.dist_app_2}/images/` },
                { expand: true, cwd: 'src/javascript/_autogenerated/app_2/', src: ['*.js'], dest: `${global.dist_app_2}/js/texts/` },

                // binary-style
                { expand: true, cwd: `${global.node_modules_paths.binary_style}/src/images/favicons`, src: ['**'], dest: `${global.dist_app_2}/images/favicons/` },

                // ChartIQ dependencies
                { expand: true, cwd: `${global.node_modules_paths.smartcharts}/dist/`, src: ['*.smartcharts.*'],  dest: `${global.dist_app_2}/js/smartcharts/` },
                { expand: true, cwd: `${global.node_modules_paths.smartcharts}/dist/`, src: ['smartcharts.css*'], dest: `${global.dist_app_2}/css/` },
            ],
        },
        get all() {
            return {
                files: [
                    ...this.app.files,
                    ...this.app_2.files,
                ],
            };
        },
    };

    return { [global.section]: config[global.section] };
};
